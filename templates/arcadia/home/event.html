{% load static %}

<section class="section-event">
    <div class="wrap-slick2">
        <div class="slick2">
            {% for event in events %}
            <div class="item-slick2" style="background-image: url('{{ event.background_image.url }}');">
                <div class="wrap-content-slide2 p-t-115 p-b-208">
                    <div class="container">
                        <div class="title-event t-center m-b-52">
                            <span class="tit2 p-l-15 p-r-15">Upcoming</span>
                            <h3 class="tit6 t-center p-l-15 p-r-15 p-t-3">Events</h3>
                        </div>

                        <div class="blo2 flex-w flex-str flex-col-c-m-lg">
                            <a href="{{ event.link|default:'#' }}" class="wrap-pic-blo2" style="background-image: url('{{ event.event_image.url }}');">
                                <div class="time-event size10 txt6 effect1">
                                    <span class="txt-effect1 flex-c-m">
                                        {{ event.event_time|date:"h:i A l - d F Y" }} <!--  Display formatted event time -->
                                    </span>
                                </div>
                            </a>

                            <div class="wrap-text-blo2 flex-col-c-m p-l-40 p-r-40 p-t-45 p-b-30"
                                 data-event-time="{{ event.event_time|date:'Y-m-d H:i:s' }}"> <!--  Countdown uses this -->

                                <h4 class="tit7 t-center m-b-10">{{ event.title }}</h4>
                                <p class="t-center">{{ event.description }}</p>

                                <!-- Countdown Timer -->
                                <div class="flex-sa-m flex-w w-full m-t-40 countdown">
                                    <div class="size11 flex-col-c-m">
                                        <span class="dis-block t-center txt7 m-b-2 days">0</span>
                                        <span class="dis-block t-center txt8">Days</span>
                                    </div>
                                    <div class="size11 flex-col-c-m">
                                        <span class="dis-block t-center txt7 m-b-2 hours">0</span>
                                        <span class="dis-block t-center txt8">Hours</span>
                                    </div>
                                    <div class="size11 flex-col-c-m">
                                        <span class="dis-block t-center txt7 m-b-2 minutes">0</span>
                                        <span class="dis-block t-center txt8">Minutes</span>
                                    </div>
                                    <div class="size11 flex-col-c-m">
                                        <span class="dis-block t-center txt7 m-b-2 seconds">0</span>
                                        <span class="dis-block t-center txt8">Seconds</span>
                                    </div>
                                </div>

                                {% comment %} <a href="{{ event.link|default:'#' }}" class="txt4 m-t-40">
                                    View Details
                                    <i class="fa fa-long-arrow-right m-l-10" aria-hidden="true"></i>
                                </a> {% endcomment %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="wrap-slick2-dots"></div>
    </div>
</section>

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    function updateCountdowns() {
        document.querySelectorAll('.wrap-text-blo2').forEach(function(el) {
            let timeStr = el.getAttribute('data-event-time');
            if (!timeStr) return;

            let eventTime = new Date(timeStr).getTime();
            let now = new Date().getTime();
            let distance = eventTime - now;

            let daysEl = el.querySelector('.days');
            let hoursEl = el.querySelector('.hours');
            let minutesEl = el.querySelector('.minutes');
            let secondsEl = el.querySelector('.seconds');

            if (distance > 0) {
                daysEl.textContent = Math.floor(distance / (1000 * 60 * 60 * 24));
                hoursEl.textContent = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                minutesEl.textContent = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                secondsEl.textContent = Math.floor((distance % (1000 * 60)) / 1000);
            } else {
                daysEl.textContent = 0;
                hoursEl.textContent = 0;
                minutesEl.textContent = 0;
                secondsEl.textContent = 0;
            }
        });
    }

    setInterval(updateCountdowns, 1000);
});
</script>
{% endblock %}
